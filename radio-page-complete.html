<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Program - Little Microphones</title>
    <meta name="description" content="Listen to personalized radio programs and join the Little Microphones community">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Little Microphones Radio Program">
    <meta property="og:description" content="Listen to personalized radio programs created by students">
    <meta property="og:type" content="website">
    
    <style>
        /* Complete Radio Page Styles - Ready for Production */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .radio-main-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .loading-container {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .loading-content {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .loading-container h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2.5em;
            font-weight: 700;
        }
        
        .loading-container p {
            color: #666;
            font-size: 18px;
            margin: 10px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        
        .program-header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .world-name {
            font-size: 3em;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .program-info {
            color: #666;
            font-size: 1.2em;
            margin: 10px 0;
        }
        
        .audio-player-container {
            margin: 30px 0;
        }
        
        .radio-player {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .player-header h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 28px;
            font-weight: 700;
        }
        
        .player-header p {
            margin: 0 0 30px 0;
            color: #666;
            font-size: 18px;
        }
        
        .player-controls {
            margin: 30px 0;
        }
        
        .player-controls audio {
            width: 100%;
            height: 60px;
            border-radius: 30px;
            outline: none;
        }
        
        .player-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .action-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .action-btn.secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
        
        .action-btn.secondary:hover {
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }
        
        .registration-container {
            margin: 30px 0;
        }
        
        .registration-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 3px solid #e9ecef;
        }
        
        .registration-card h3 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 24px;
            font-weight: 700;
        }
        
        .registration-card p {
            margin: 0 0 25px 0;
            color: #6c757d;
            line-height: 1.6;
            font-size: 16px;
        }
        
        .register-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .register-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .error-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border-left: 6px solid #dc3545;
            text-align: center;
        }
        
        .error-container h2 {
            color: #dc3545;
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        .error-container p {
            color: #721c24;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .success-message {
            background: white;
            border: 3px solid #28a745;
            border-radius: 15px;
            padding: 20px;
            color: #155724;
            text-align: center;
            margin: 20px 0;
            font-weight: 600;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .radio-main-container {
                padding: 10px;
            }
            
            .world-name {
                font-size: 2.2em;
            }
            
            .loading-container {
                padding: 40px 15px;
            }
            
            .loading-container h1 {
                font-size: 2em;
            }
            
            .radio-player, .program-header, .registration-card {
                padding: 25px;
                margin: 15px 0;
            }
            
            .player-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .action-btn {
                width: 200px;
            }
        }
        
        @media (max-width: 480px) {
            .world-name {
                font-size: 1.8em;
            }
            
            .player-header h3 {
                font-size: 22px;
            }
            
            .radio-player, .program-header, .registration-card {
                padding: 20px;
            }
        }
    </style>
</head>

<body>
    <!-- Main Container -->
    <div id="main-container" class="radio-main-container">
        
        <!-- Loading State (Initial) -->
        <div id="loading-container" class="loading-container">
            <div class="loading-content">
                <h1 class="pulse">üéµ Little Microphones</h1>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <p id="loading-message">Loading radio program...</p>
            </div>
        </div>
        
        <!-- Program Header -->
        <div id="program-header" class="program-header" style="display: none;">
            <h1 id="world-name" class="world-name"></h1>
            <div id="program-info" class="program-info"></div>
        </div>
        
        <!-- Audio Player Container -->
        <div id="audio-player-container" class="audio-player-container" style="display: none;">
            <!-- Radio.js will populate this -->
        </div>
        
        <!-- Registration Container -->
        <div id="registration-container" class="registration-container" style="display: none;">
            <!-- Radio.js will populate this -->
        </div>
        
        <!-- Error Container -->
        <div id="error-container" class="error-container" style="display: none;">
            <!-- Radio.js will populate this -->
        </div>
        
    </div>

    <!-- Memberstack Script - ALREADY LOADED GLOBALLY IN WEBFLOW -->
    <!-- No need to add Memberstack script here - it's already loaded globally -->

    <!-- Complete Radio.js Script -->
    <script>
/**
 * radio.js - Universal Radio Program Page Script
 * COMPLETE PRODUCTION VERSION
 */

// Global state management
let currentRadioData = null;
let currentShareId = null;
let audioPlayer = null;
let isGenerating = false;

/**
 * Initialize the radio page when DOM is ready
 */
document.addEventListener('DOMContentLoaded', async () => {
    console.log('üéµ Radio page initializing...');
    
    try {
        // Extract ShareID from URL
        currentShareId = getShareIdFromUrl();
        if (!currentShareId) {
            showError('Invalid Link', 'This radio program link is missing required information. Please check the link and try again.');
            return;
        }
        
        console.log(`üìª Loading radio data for ShareID: ${currentShareId}`);
        showLoadingState('Loading radio program...');
        
        // Fetch radio data from API
        currentRadioData = await fetchRadioData(currentShareId);
        
        if (!currentRadioData) {
            showError('Program Not Found', 'This radio program could not be found. The link may be expired or invalid.');
            return;
        }
        
        // Update page with program information
        updatePageContent(currentRadioData);
        
        // Determine if we need to generate a new program
        console.log(`üîç Checking program status: needsNewProgram=${currentRadioData.needsNewProgram}, hasManifest=${!!currentRadioData.lastManifest}`);
        
        if (currentRadioData.needsNewProgram) {
            console.log('üîÑ New recordings detected - generating updated program...');
            await generateNewProgram();
        } else if (currentRadioData.lastManifest && currentRadioData.lastManifest.programUrl) {
            console.log('‚úÖ Program is up to date - displaying existing program');
            showExistingProgram(currentRadioData.lastManifest);
        } else {
            console.log('üìù No existing program found - generating initial program...');
            await generateNewProgram();
        }
        
        // Setup registration functionality
        setupRegistrationFlow();
        
    } catch (error) {
        console.error('‚ùå Radio page initialization failed:', error);
        showError('Loading Error', 'Failed to load the radio program. Please try refreshing the page.');
    }
});

/**
 * Extract ShareID from URL parameters
 */
function getShareIdFromUrl() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('ID');
}

/**
 * Fetch radio data from the API
 */
async function fetchRadioData(shareId) {
    try {
        const response = await fetch(`https://little-microphones.vercel.app/api/get-radio-data?shareId=${shareId}`);
        
        if (!response.ok) {
            throw new Error(`API request failed: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (!data.success) {
            throw new Error(data.error || 'Failed to fetch radio data');
        }
        
        return data;
    } catch (error) {
        console.error('Failed to fetch radio data:', error);
        return null;
    }
}

/**
 * Update page content with radio program information
 */
function updatePageContent(radioData) {
    // Update page title
    const worldName = radioData.world.charAt(0).toUpperCase() + radioData.world.slice(1).replace(/-/g, ' ');
    document.title = `${worldName} Radio Program - Little Microphones`;
    
    // Update world name in UI
    const worldElement = document.getElementById('world-name');
    if (worldElement) {
        worldElement.textContent = worldName;
    }
    
    // Update program info
    const programInfoElement = document.getElementById('program-info');
    if (programInfoElement) {
        programInfoElement.innerHTML = `
            <p><strong>Program ID:</strong> ${radioData.lmid}</p>
            <p><strong>Recordings:</strong> ${radioData.recordingCount}</p>
            <p><strong>World:</strong> ${worldName}</p>
        `;
    }
    
    console.log(`üìä Program info: ${worldName}, LMID ${radioData.lmid}, ${radioData.recordingCount} recordings`);
}

/**
 * Generate a new radio program
 */
async function generateNewProgram() {
    if (isGenerating) {
        console.log('‚è≥ Generation already in progress...');
        return;
    }
    
    isGenerating = true;
    
    try {
        showLoadingState('Generating new radio program...');
        updateProgress('Collecting recordings...', 10);
        
        // Convert recordings to proper audioSegments format
        const audioSegments = convertRecordingsToAudioSegments(currentRadioData.currentRecordings, currentRadioData.world);
        
        // Call the combine-audio API to generate new program
        const response = await fetch('https://little-microphones.vercel.app/api/combine-audio', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                world: currentRadioData.world,
                lmid: currentRadioData.lmid,
                audioSegments: audioSegments
            })
        });
        
        updateProgress('Processing audio...', 50);
        
        if (!response.ok) {
            throw new Error(`Generation failed: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (!result.success) {
            throw new Error(result.error || 'Radio program generation failed');
        }
        
        updateProgress('Finalizing program...', 90);
        
        // Update the manifest data
        currentRadioData.lastManifest = {
            generatedAt: new Date().toISOString(),
            programUrl: result.url,
            filesUsed: currentRadioData.currentRecordings.map(rec => rec.filename)
        };
        
        updateProgress('Complete!', 100);
        
        console.log('‚úÖ New radio program generated successfully');
        showGeneratedProgram(result.url);
        
    } catch (error) {
        console.error('‚ùå Program generation failed:', error);
        showError('Generation Failed', `Failed to generate radio program: ${error.message}`);
    } finally {
        isGenerating = false;
    }
}

/**
 * Show existing radio program
 */
function showExistingProgram(manifest) {
    if (!manifest || !manifest.programUrl) {
        console.log('üìù No existing program found - generating new one...');
        generateNewProgram();
        return;
    }
    
    console.log('üéµ Displaying existing radio program');
    showAudioPlayer(manifest.programUrl);
    hideLoadingState();
}

/**
 * Show newly generated program
 */
function showGeneratedProgram(audioUrl) {
    console.log('üéâ Displaying newly generated radio program');
    showAudioPlayer(audioUrl);
    hideLoadingState();
    
    // Show success message
    showSuccessMessage('New radio program generated with latest recordings!');
}

/**
 * Display audio player with given URL
 */
function showAudioPlayer(audioUrl) {
    const playerContainer = document.getElementById('audio-player-container');
    if (!playerContainer) {
        console.error('Audio player container not found');
        return;
    }
    
    // Create professional audio player
    playerContainer.innerHTML = `
        <div class="radio-player">
            <div class="player-header">
                <h3>üéµ Your Radio Program is Ready!</h3>
                <p>Listen to your personalized radio show</p>
            </div>
            <div class="player-controls">
                <audio id="radio-audio" controls preload="metadata">
                    <source src="${audioUrl}" type="audio/mpeg">
                    <source src="${audioUrl}" type="audio/mp3">
                    Your browser does not support the audio element.
                </audio>
            </div>
            <div class="player-actions">
                <button id="download-btn" class="action-btn">üì• Download</button>
                <button id="share-btn" class="action-btn">üîó Share Link</button>
                <button id="regenerate-btn" class="action-btn secondary">üîÑ Update Program</button>
            </div>
        </div>
    `;
    
    // Store audio player reference
    audioPlayer = document.getElementById('radio-audio');
    
    // Setup player event listeners
    setupAudioPlayerEvents();
    
    // Setup action buttons
    setupActionButtons(audioUrl);
    
    // Show the player
    playerContainer.style.display = 'block';
}

/**
 * Setup audio player event listeners
 */
function setupAudioPlayerEvents() {
    if (!audioPlayer) return;
    
    audioPlayer.addEventListener('loadstart', () => {
        console.log('üîÑ Audio loading started...');
    });
    
    audioPlayer.addEventListener('canplay', () => {
        console.log('‚úÖ Audio ready to play');
    });
    
    audioPlayer.addEventListener('error', (e) => {
        console.error('‚ùå Audio playback error:', e);
        showError('Playback Error', 'Unable to play the audio file. Please try refreshing the page.');
    });
    
    audioPlayer.addEventListener('ended', () => {
        console.log('üéµ Audio playback completed');
        showSuccessMessage('Thanks for listening! Share this program with others.');
    });
}

/**
 * Setup action button event listeners
 */
function setupActionButtons(audioUrl) {
    // Download button
    const downloadBtn = document.getElementById('download-btn');
    if (downloadBtn) {
        downloadBtn.addEventListener('click', () => {
            const link = document.createElement('a');
            link.href = audioUrl;
            link.download = `radio-program-${currentRadioData.world}-${currentRadioData.lmid}.mp3`;
            link.click();
        });
    }
    
    // Share button
    const shareBtn = document.getElementById('share-btn');
    if (shareBtn) {
        shareBtn.addEventListener('click', () => {
            const shareUrl = window.location.href;
            if (navigator.share) {
                navigator.share({
                    title: 'Little Microphones Radio Program',
                    url: shareUrl
                });
            } else {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    showSuccessMessage('Link copied to clipboard!');
                });
            }
        });
    }
    
    // Regenerate button
    const regenerateBtn = document.getElementById('regenerate-btn');
    if (regenerateBtn) {
        regenerateBtn.addEventListener('click', async () => {
            if (confirm('Generate a new version with the latest recordings?')) {
                await generateNewProgram();
            }
        });
    }
}

/**
 * Setup registration flow for parents
 */
function setupRegistrationFlow() {
    // Check if Memberstack is available and user is logged in
    const memberstack = window.$memberstackDom;
    
    if (!memberstack) {
        console.log('üìù Memberstack not available - showing registration option');
        showRegistrationOption();
        return;
    }
    
    // Check if user is already logged in
    memberstack.getCurrentMember()
        .then(({ data: memberData }) => {
            if (memberData) {
                console.log('üë§ User is logged in - hiding registration option');
                hideRegistrationOption();
            } else {
                console.log('üìù User not logged in - showing registration option');
                showRegistrationOption();
            }
        })
        .catch(error => {
            console.error('Error checking member status:', error);
            showRegistrationOption(); // Show registration as fallback
        });
}

/**
 * Show registration option for parents
 */
function showRegistrationOption() {
    const registrationContainer = document.getElementById('registration-container');
    if (!registrationContainer) {
        console.warn('Registration container not found in DOM');
        return;
    }
    
    registrationContainer.innerHTML = `
        <div class="registration-card">
            <h3>üé§ Want to add your own recordings?</h3>
            <p>Register to create your own version of this radio program with your family's recordings!</p>
            <button id="register-btn" class="register-btn">
                üìù Register to Record
            </button>
        </div>
    `;
    
    // Setup registration button
    const registerBtn = document.getElementById('register-btn');
    if (registerBtn) {
        registerBtn.addEventListener('click', handleRegistration);
    }
    
    // Show the registration container
    registrationContainer.style.display = 'block';
}

/**
 * Hide registration option
 */
function hideRegistrationOption() {
    const registrationContainer = document.getElementById('registration-container');
    if (registrationContainer) {
        registrationContainer.style.display = 'none';
    }
}

/**
 * Handle user registration with ShareID metadata
 */
function handleRegistration() {
    const memberstack = window.$memberstackDom;
    
    if (!memberstack) {
        showError('Registration Error', 'Registration system is not available. Please try again later.');
        return;
    }
    
    try {
        // Start registration process with ShareID metadata
        memberstack.openModal('signup', {
            metadata: {
                originating_share_id: currentShareId
            }
        });
        
        console.log(`üìù Registration started with ShareID: ${currentShareId}`);
        
    } catch (error) {
        console.error('Registration error:', error);
        showError('Registration Error', 'Failed to start registration. Please try again.');
    }
}

/**
 * Convert raw recordings to audioSegments format expected by combine-audio API
 * @param {Array} recordings - Raw recordings from get-radio-data
 * @param {string} world - World name
 * @returns {Array} Formatted audioSegments
 */
function convertRecordingsToAudioSegments(recordings, world) {
    const audioSegments = [];
    
    // Group recordings by questionId
    const recordingsByQuestion = {};
    recordings.forEach(recording => {
        const questionId = recording.questionId;
        if (!recordingsByQuestion[questionId]) {
            recordingsByQuestion[questionId] = [];
        }
        recordingsByQuestion[questionId].push(recording);
    });
    
    // Sort question IDs numerically
    const sortedQuestionIds = Object.keys(recordingsByQuestion).sort((a, b) => parseInt(a) - parseInt(b));
    
    // 1. Add intro
    const introTimestamp = Date.now();
    audioSegments.push({
        type: 'single',
        url: `https://little-microphones.b-cdn.net/audio/other/intro.mp3?t=${introTimestamp}`
    });
    
    // 2. Add questions and answers in order
    sortedQuestionIds.forEach(questionId => {
        const questionRecordings = recordingsByQuestion[questionId];
        
        // Add question prompt
        const cacheBustTimestamp = Date.now() + Math.random();
        audioSegments.push({
            type: 'single',
            url: `https://little-microphones.b-cdn.net/audio/${world}/${world}-QID${questionId}.mp3?t=${cacheBustTimestamp}`
        });
        
        // Sort answers by filename timestamp (first recorded = first played)
        const sortedAnswers = questionRecordings.sort((a, b) => {
            const timestampA = extractTimestampFromFilename(a.filename);
            const timestampB = extractTimestampFromFilename(b.filename);
            return timestampA - timestampB;
        });
        
        // Combine answers with background music
        const backgroundTimestamp = Date.now() + Math.random();
        audioSegments.push({
            type: 'combine_with_background',
            answerUrls: sortedAnswers.map(recording => recording.url),
            backgroundUrl: `https://little-microphones.b-cdn.net/audio/other/monkeys.mp3?t=${backgroundTimestamp}`,
            questionId: questionId
        });
    });
    
    // 3. Add outro
    const outroTimestamp = Date.now() + 1;
    audioSegments.push({
        type: 'single',
        url: `https://little-microphones.b-cdn.net/audio/other/outro.mp3?t=${outroTimestamp}`
    });
    
    console.log(`üéº Generated ${audioSegments.length} audio segments for ${sortedQuestionIds.length} questions`);
    return audioSegments;
}

/**
 * Extract timestamp from recording filename
 * @param {string} filename - Recording filename
 * @returns {number} Timestamp
 */
function extractTimestampFromFilename(filename) {
    const match = filename.match(/tm_(\d+)/);
    return match ? parseInt(match[1]) : 0;
}

/**
 * Show loading state
 */
function showLoadingState(message) {
    const loadingContainer = document.getElementById('loading-container');
    const loadingMessage = document.getElementById('loading-message');
    
    if (loadingMessage) {
        loadingMessage.textContent = message;
    }
    
    if (loadingContainer) {
        loadingContainer.style.display = 'block';
    }
    
    // Hide other containers
    hideOtherContainers();
}

/**
 * Update progress during loading/generation
 */
function updateProgress(message, percentage) {
    const progressFill = document.getElementById('progress-fill');
    const loadingMessage = document.getElementById('loading-message');
    
    if (progressFill) {
        progressFill.style.width = `${percentage}%`;
    }
    
    if (loadingMessage) {
        loadingMessage.textContent = message;
    }
}

/**
 * Hide loading state
 */
function hideLoadingState() {
    const loadingContainer = document.getElementById('loading-container');
    if (loadingContainer) {
        loadingContainer.style.display = 'none';
    }
    
    // Show program header
    const programHeader = document.getElementById('program-header');
    if (programHeader) {
        programHeader.style.display = 'block';
    }
}

/**
 * Hide other containers
 */
function hideOtherContainers() {
    const containers = ['program-header', 'audio-player-container', 'registration-container', 'error-container'];
    containers.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.style.display = 'none';
        }
    });
}

/**
 * Show error message
 */
function showError(title, message) {
    const errorContainer = document.getElementById('error-container');
    if (!errorContainer) return;
    
    errorContainer.innerHTML = `
        <h2>‚ùå ${title}</h2>
        <p>${message}</p>
        <button onclick="window.location.reload()" style="margin-top: 15px; padding: 15px 25px; border: none; background: #dc3545; color: white; border-radius: 50px; cursor: pointer; font-weight: 600;">
            üîÑ Try Again
        </button>
    `;
    
    // Hide other containers and show error
    hideOtherContainers();
    document.getElementById('loading-container').style.display = 'none';
    errorContainer.style.display = 'block';
}

/**
 * Show success message
 */
function showSuccessMessage(message) {
    // Create temporary success message
    const successDiv = document.createElement('div');
    successDiv.className = 'success-message';
    successDiv.textContent = message;
    
    const mainContainer = document.getElementById('main-container');
    if (mainContainer) {
        mainContainer.appendChild(successDiv);
    }
    
    // Auto-remove after 3 seconds
    setTimeout(() => {
        if (successDiv.parentNode) {
            successDiv.parentNode.removeChild(successDiv);
        }
    }, 3000);
}

// Export functions for global access
window.radioPageAPI = {
    generateNewProgram,
    getCurrentData: () => currentRadioData,
    getCurrentShareId: () => currentShareId
};

console.log('üìª Radio page script loaded and ready');
    </script>
</body>
</html> 